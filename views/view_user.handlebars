<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">User Details</li>
    </ol>
</nav>

<div class="card bg-black white-border">
    <div class="row">
        <div class="col-md-3">
            <div class="p-2">
                <img class="img-fluid img-thumbnail" src="/static/{{ data.image }}" width="200" height="400">
            </div>
        </div>
        <div class="col-md-9">
            <div class="p-2">
                <h4>{{ data.name }}</h4>
                <p class="mb-0"><i class="fas fa-envelope"></i> {{ data.email }}</p>
                <p class="mb-0"><i class="fas fa-phone-square"></i> {{ data.phone }}</p>
                <p class="mb-0"><i class="fas fa-map-marker-alt"></i> {{ data.address }}</p>
                <p class="mb-0"><i class="fas fa-hdd"></i>
                    {{#if data.devices.length }}
                    {{ data.devices.length }} Device Assigned
                    {{else }}
                    NoDevice Assigned
                    {{/if}}
                </p>
            </div>
            <div class="float-right p-2">
                <a href="/webuser/assigndevice/{{ data._id }}" class="btn btn-success btn-circle" title="Assign Device">
                    <i class="fas fa-plus"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="card mt-5 mb-5 no-border">
    <div class="card-header bg-black text-center">
        Device Uses By {{ data.name }}
    </div>
    <div class="p-2 bg-light-black">
        <div class="row bg-light-black ">
        {{#each data.devices }}
        <div class="col-md-6" >
            <div class="card mt-2 mb-2 bg-light-black temCal" id="{{ device_id }}">
                <ul class="list-group white-border user-device-list">
                    <li class="list-group-item no-back white-border" style="border-radius: 0 !important">Device Id : <span class="float-right"><a href="/webdevice/view_device/{{ _id }}">{{ device_id }}</a></span></li>
                    <li class="list-group-item no-back white-border">SIM Number : <span class="float-right">{{ sim_number }}</span></li>
                    <li class="list-group-item no-back white-border">Actived Date : <span class="float-right">23-06-2018</span></li>
                    <li class="list-group-item no-back white-border">Location: <span class="float-right">{{ location }}</span></li>
                    <li class="list-group-item no-back white-border lock-door" style="border-radius: 0 !important"></li>
                </ul>
                <div class="row mt-2 pl-2 pr-2">
                    <div class="col-md-6">
                    <div class="card text-white mb-3">
                        <div class="card-header bg-black text-center temp-humi-edit dropleft">
                            Temperature
                        </div>
                        <div class="card-body bg-success">
                            <h3 class="temp-title card-title"></h3>
                        </div>
                    </div>
                    </div>
                    <div class="col-md-6">
                    <div class="card text-white mb-3">
                        <div class="card-header bg-black text-center temp-humi-edit dropleft">
                            Humidity
                        </div>
                        <div class="card-body bg-warning">
                            <h3 class="card-title"></h3>
                        </div>
                    </div>
                    </div>
                </div>
                <a href="/webuser/unassign/{{ _id }}" class="btn btn-block btn-danger btn-sm">Unassign Device</a>
            </div>
        </div>          
        {{/each }}
    </div>
    </div>
    
</div>

<script>
    $("document").ready(function () {

        function showStr(val) {
            if (val == '1') {
                return "On";
            } else {
                return "Off";
            }
        }

        setInterval(function () {
            $.each($('.temCal'), function (index, obj) {
                console.log(obj.id)
                $.ajax({
                    url: 'http://localhost:5000/cm/' + obj.id + '/last_data',
                    type: 'GET',
                    success: function (data) {
                        if (data) {
                            var device_id = data.device_id
                            $('#' + device_id + '>ul>li:last' ).html('Door Lock: <span class="float-right">'+ showStr(data.door_lock) +'</span>');
                            $('#' + device_id).find('h3:first').html(data.temperature +' <sup>o</sup>C');
                            $('#' + device_id).find('h3:last').html(data.humidity +' <sup>o</sup>C');
                        }
                    }
                });
            })
        }, 3000);
    });
</script>




{{!-- <div class="col-lg-12">
    <div class="panel panel-default">
        <div class="panel-body"> --}}
            {{!-- <a href="assigndevice/?user_id={{ data._id }}" class="btn btn-primary pull-right">Assign Devie</a> --}}
            {{!-- <a href="/webuser/assigndevice/{{ data._id }}" class="btn btn-primary pull-right">Assign Devie</a> --}}
            {{!-- <button class="btn btn-primary pull-right" id="abc" data-id="{{ data._id }}" data-backdrop='static' data-keyboard='false'
                        data-toggle="modal">Assign Devie</button> --}}
            {{!-- <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover table-responsive"> --}}
                    {{!-- <tr>
                                <th>User Image</th>
                                <td><img src="/static/{{ data.image }}" width="150" height="150"> </td>
                            </tr>
                            <tr>
                                <th>User Name</th>
                                <td>{{ data.name }}</td>
                            </tr>
                            <tr>
                                <th>User Phone</th>
                                <td>{{ data.phone }}</td>
                            </tr>
                            <tr>
                                <th>User Email</th>
                                <td>{{ data.email }}</td>
                            </tr>
                            <tr>
                                <th>User Address</th>
                                <td>{{ data.address }}</td>
                            </tr>
                            <tr>
                                <th>Assign Device</th>
                                <td>
                                    {{#if data.devices.length }}
                                    {{ data.devices.length }} Device Assigned
                                    {{else }}
                                    NoDevice Assigned
                                    {{/if}}
                                </td>
                            </tr> --}}
                    {{!-- <tr>
                        <td colspan="2">
                            <div class="row">
                                {{#each data.devices }}
                                <div class="col-lg-4">
                                    <div class="panel panel-primary">
                                        <div class="panel-heading text-center">
                                            Device Id: {{ device_id }}
                                        </div>
                                        <div class="panel-body">
                                            <p>SIM Number : {{ sim_number }}</p>
                                            <p>Location : {{ location }}</p>
                                            <div class="temCal" id="{{ device_id }}"> </div>
                                        </div>
                                        <div class="panel-footer">
                                            <a href="/webuser/unassign/{{ _id }}"
                                                class="btn btn-block btn-danger btn-sm">Unassign</a>
                                        </div>
                                    </div>
                                </div>
                                {{/each }}
                            </div>
                        </td>
                    </tr> --}}
                {{!-- </table>
            </div>
        </div>
    </div>
</div> --}}

{{!-- <script>
    $("document").ready(function () {

        function showStr(val) {
            if (val == '1') {
                return "On";
            } else {
                return "Off";
            }
        }

        setInterval(function () {
            $.each($('.temCal'), function (index, obj) {
                $.ajax({
                    url: 'http://localhost:5000/cm/' + obj.id + '/last_data',
                    type: 'GET',
                    success: function (data) {
                        if (data) {
                            var device_id = data.device_id
                            $('#' + device_id).html('<p>Temparature : ' + data.temperature + '</p><p>Humidity : ' + data.humidity + '</p><p>Door Lock : ' + showStr(data.door_lock) + '</p>')
                        }
                    }
                });
            })
        }, 3000);
    });
</script> --}}